<?php
/**
 * ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€Œäººæ°—ã®æ¤œç´¢ã€ã®è² è·åˆ†æ
 * 
 * 1GBãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºã§ã®å½±éŸ¿è©•ä¾¡
 */

echo "=== ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€Œäººæ°—ã®æ¤œç´¢ã€è² è·åˆ†æ ===\n\n";

// ç¾åœ¨ã®ã‚¯ã‚¨ãƒªåˆ†æ
echo "ğŸ“Š ç¾åœ¨ã®ã‚¯ã‚¨ãƒªåˆ†æ:\n";
echo "å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«: global_search_history\n";
echo "ã‚¯ã‚¨ãƒªæ¡ä»¶: searched_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)\n";
echo "å‡¦ç†å†…å®¹: GROUP BY, COUNT, ORDER BY, LIMIT 20\n";
echo "å®Ÿè¡Œé »åº¦: å…¨ãƒšãƒ¼ã‚¸è¡¨ç¤ºæ™‚ï¼ˆæ¯å›ï¼‰\n\n";

// ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºåˆ¥ã®å½±éŸ¿è©•ä¾¡
$tableSizes = [
    '100MB' => 100,
    '500MB' => 500,
    '1GB' => 1024,
    '2GB' => 2048,
    '5GB' => 5120
];

echo "=== ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºåˆ¥ã®è² è·è©•ä¾¡ ===\n\n";

foreach ($tableSizes as $sizeLabel => $sizeMB) {
    echo "ğŸ“ˆ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚º: {$sizeLabel}\n";
    
    // æ¨å®šãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ï¼ˆ1ãƒ¬ã‚³ãƒ¼ãƒ‰ç´„0.5KBï¼‰
    $estimatedRecords = ($sizeMB * 1024) / 0.5;
    
    // 30æ—¥ä»¥å†…ã®ãƒ‡ãƒ¼ã‚¿å‰²åˆï¼ˆä»®å®šï¼‰
    $recentDataRatio = 0.3; // 30%
    $recentRecords = $estimatedRecords * $recentDataRatio;
    
    echo "- æ¨å®šç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: " . number_format($estimatedRecords) . " ä»¶\n";
    echo "- 30æ—¥ä»¥å†…ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: " . number_format($recentRecords) . " ä»¶\n";
    
    // è² è·è©•ä¾¡
    if ($sizeMB <= 100) {
        $loadLevel = "ğŸŸ¢ è»½å¾®";
        $description = "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒåŠ¹ãã€é«˜é€Ÿå®Ÿè¡Œ";
        $executionTime = "10-50ms";
    } elseif ($sizeMB <= 500) {
        $loadLevel = "ğŸŸ¡ ä¸­ç¨‹åº¦";
        $description = "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ã€ã‚„ã‚„é‡ã„";
        $executionTime = "50-200ms";
    } elseif ($sizeMB <= 1024) {
        $loadLevel = "ğŸŸ  é‡ã„";
        $description = "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹ç‡ä½ä¸‹ã€æ³¨æ„ãŒå¿…è¦";
        $executionTime = "200-500ms";
    } elseif ($sizeMB <= 2048) {
        $loadLevel = "ğŸ”´ éå¸¸ã«é‡ã„";
        $description = "ãƒ•ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã®å¯èƒ½æ€§";
        $executionTime = "500ms-2s";
    } else {
        $loadLevel = "ğŸš¨ å±é™º";
        $description = "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å¯èƒ½æ€§";
        $executionTime = "2sä»¥ä¸Š";
    }
    
    echo "- è² è·ãƒ¬ãƒ™ãƒ«: {$loadLevel}\n";
    echo "- èª¬æ˜: {$description}\n";
    echo "- æ¨å®šå®Ÿè¡Œæ™‚é–“: {$executionTime}\n\n";
}

// 1GBãƒ†ãƒ¼ãƒ–ãƒ«ã§ã®è©³ç´°åˆ†æ
echo "=== 1GBãƒ†ãƒ¼ãƒ–ãƒ«ã§ã®è©³ç´°åˆ†æ ===\n\n";

$tableSizeGB = 1;
$tableSizeMB = 1024;
$estimatedRecords = ($tableSizeMB * 1024) / 0.5; // ç´„200ä¸‡ãƒ¬ã‚³ãƒ¼ãƒ‰
$recentRecords = $estimatedRecords * 0.3; // ç´„60ä¸‡ãƒ¬ã‚³ãƒ¼ãƒ‰

echo "ğŸ“Š 1GBãƒ†ãƒ¼ãƒ–ãƒ«ã®è©³ç´°:\n";
echo "- ç·ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: " . number_format($estimatedRecords) . " ä»¶\n";
echo "- 30æ—¥ä»¥å†…ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: " . number_format($recentRecords) . " ä»¶\n";
echo "- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º: ç´„200-300MB\n";
echo "- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ç´„50-100MBï¼ˆã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚ï¼‰\n\n";

// è² è·ã®å½±éŸ¿è©•ä¾¡
echo "ğŸš¨ 1GBãƒ†ãƒ¼ãƒ–ãƒ«ã§ã®è² è·å½±éŸ¿:\n\n";

echo "1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è² è·:\n";
echo "   - ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“: 200-500ms\n";
echo "   - CPUä½¿ç”¨ç‡: ä¸­ç¨‹åº¦\n";
echo "   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 50-100MB\n";
echo "   - ãƒ‡ã‚£ã‚¹ã‚¯I/O: ä¸­ç¨‹åº¦\n\n";

echo "2. ãƒšãƒ¼ã‚¸è¡¨ç¤ºã¸ã®å½±éŸ¿:\n";
echo "   - ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“: +200-500ms\n";
echo "   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“: ä½“æ„Ÿã§ãã‚‹é…å»¶\n";
echo "   - åŒæ™‚æ¥ç¶šæ•°: åˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§\n\n";

echo "3. ãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã¸ã®å½±éŸ¿:\n";
echo "   - ãƒªã‚½ãƒ¼ã‚¹æ¶ˆè²»: é«˜\n";
echo "   - ä»–ã®å‡¦ç†ã¸ã®å½±éŸ¿: ã‚ã‚Š\n";
echo "   - ã‚µãƒ¼ãƒãƒ¼è² è·: ä¸­-é«˜\n";
echo "   - åˆ¶é™ã«é”ã™ã‚‹å¯èƒ½æ€§: ã‚ã‚Š\n\n";

// è§£æ±ºç­–ã®ææ¡ˆ
echo "=== è§£æ±ºç­–ã®ææ¡ˆ ===\n\n";

echo "ğŸ¯ å³åº§ã«å®Ÿè£…ã™ã¹ãå¯¾ç­–:\n\n";

echo "1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…:\n";
echo "   - äººæ°—æ¤œç´¢çµæœã‚’1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥\n";
echo "   - è² è·ã‚’99%å‰Šæ¸›å¯èƒ½\n";
echo "   - å®Ÿè£…é›£æ˜“åº¦: ä½\n\n";

echo "2. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–:\n";
echo "   - searched_at + search_type ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\n";
echo "   - ã‚¯ã‚¨ãƒªæ€§èƒ½ã‚’50-80%å‘ä¸Š\n";
echo "   - å®Ÿè£…é›£æ˜“åº¦: ä½\n\n";

echo "3. ãƒ‡ãƒ¼ã‚¿é›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ:\n";
echo "   - æ—¥æ¬¡ã§äººæ°—æ¤œç´¢ã‚’é›†è¨ˆ\n";
echo "   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¯ã‚¨ãƒªã‚’å›é¿\n";
echo "   - å®Ÿè£…é›£æ˜“åº¦: ä¸­\n\n";

echo "4. ãƒšãƒ¼ã‚¸åˆ†å‰²:\n";
echo "   - ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’Ajaxã§é…å»¶èª­ã¿è¾¼ã¿\n";
echo "   - åˆæœŸãƒšãƒ¼ã‚¸è¡¨ç¤ºã‚’é«˜é€ŸåŒ–\n";
echo "   - å®Ÿè£…é›£æ˜“åº¦: ä¸­\n\n";

// ç·Šæ€¥åº¦è©•ä¾¡
echo "=== ç·Šæ€¥åº¦è©•ä¾¡ ===\n\n";

echo "ğŸš¨ 1GBãƒ†ãƒ¼ãƒ–ãƒ«ã§ã®ç·Šæ€¥åº¦: é«˜\n\n";
echo "ç†ç”±:\n";
echo "- å…¨ãƒšãƒ¼ã‚¸ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚å½±éŸ¿ç¯„å›²ãŒåºƒã„\n";
echo "- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«ç›´æ¥å½±éŸ¿\n";
echo "- ã‚µãƒ¼ãƒãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã‚’å¤§é‡æ¶ˆè²»\n";
echo "- ä»–ã®å‡¦ç†ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿\n\n";

echo "æ¨å¥¨å¯¾å¿œé †åº:\n";
echo "1. å³åº§: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…\n";
echo "2. 1é€±é–“ä»¥å†…: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–\n";
echo "3. 1ãƒ¶æœˆä»¥å†…: ãƒ‡ãƒ¼ã‚¿é›†è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ\n";
echo "4. é•·æœŸ: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¦‹ç›´ã—\n\n";

// å…·ä½“çš„ãªå®Ÿè£…ä¾‹
echo "=== å…·ä½“çš„ãªå®Ÿè£…ä¾‹ ===\n\n";

echo "ğŸ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…ä¾‹:\n";
echo "```php\n";
echo "function getPopularSearchesCached(\$lang = 'ja') {\n";
echo "    \$cacheKey = 'popular_searches_' . \$lang;\n";
echo "    \$cacheFile = 'cache/' . \$cacheKey . '.json';\n";
echo "    \n";
echo "    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒ1æ™‚é–“ä»¥å†…ãªã‚‰ä½¿ç”¨\n";
echo "    if (file_exists(\$cacheFile) && \n";
echo "        (time() - filemtime(\$cacheFile)) < 3600) {\n";
echo "        return json_decode(file_get_contents(\$cacheFile), true);\n";
echo "    }\n";
echo "    \n";
echo "    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¤ã„å ´åˆã¯å†å–å¾—\n";
echo "    \$searches = getPopularSearches(\$lang);\n";
echo "    file_put_contents(\$cacheFile, json_encode(\$searches));\n";
echo "    return \$searches;\n";
echo "}\n";
echo "```\n\n";

echo "ğŸ“ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–:\n";
echo "```sql\n";
echo "CREATE INDEX idx_searched_at_search_type \n";
echo "ON global_search_history (searched_at, search_type);\n";
echo "```\n\n";

// ã¾ã¨ã‚
echo "=== ã¾ã¨ã‚ ===\n\n";
echo "1GBãƒ†ãƒ¼ãƒ–ãƒ«ã§ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã€Œäººæ°—ã®æ¤œç´¢ã€ã¯:\n";
echo "- è² è·ãƒ¬ãƒ™ãƒ«: ğŸ”´ éå¸¸ã«é‡ã„\n";
echo "- ç·Šæ€¥åº¦: ğŸš¨ é«˜\n";
echo "- å¯¾å¿œãŒå¿…è¦: å³åº§\n\n";
echo "æœ€å„ªå…ˆã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€\n";
echo "æ®µéšçš„ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’è¡Œã†ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚\n";
